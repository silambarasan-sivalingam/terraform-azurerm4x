<!-- BEGIN_TF_DOCS -->
<!--

  ** DO NOT EDIT THIS FILE
  ** This file was automatically generated by using Terraform Docs
  ** 1) Make all changes on files under docs/*.md
  ** 2) Run `terraform-docs .` to rebuild this file
  **
  ** By following this practice we ensure standard and high-quality across multiple projects.
  ** DO NOT EDIT THIS FILE
-->

# Batch Pool

## Introduction

This module Creates a batch pool

This component creates the following Azure resources :

- Batch pool

## Dependencies

This component depends on the following resources :

- Resource Group
- Batch account

## Requirements

| Name | Version |
|------|---------|
| terraform | >= 1.7.5 |

## Providers

| Name | Version |
|------|---------|
| azurerm | >=2.74.0 |

## Owner and POC

## Current Production Release

`v2.0.0`

## Requirements

No requirements.

## Providers

| Name | Version |
|------|---------|
| <a name="provider_azurerm"></a> [azurerm](#provider\_azurerm) | n/a |

## Modules

No modules.

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_settings"></a> [settings](#input\_settings) | n/a | <pre>object({<br>    name              = string<br>    resource_group_name = string<br>    display_name      = string<br>    account_name      = string<br>    vm_size           = string<br>    node_agent_sku_id = string<br>    auto_scale = object({<br>      evaluation_interval = string<br>      formula             = string<br>    })<br><br>    storage_image_reference = optional(object({<br>      publisher = string<br>      offer     = string<br>      sku       = string<br>      version   = string<br>    }))<br><br>    container_configuration = optional(object({<br>      type = string<br>      container_registries = list(object({<br>        registry_server = string<br>        user_name       = string<br>        password        = string<br>      }))<br>    }))<br><br>    start_task = optional(object({<br>      command_line                  = string<br>      task_retry_maximum            = number<br>      wait_for_success              = bool<br>      common_environment_properties = map(string)<br>      user_identity = object({<br>        auto_user = object({<br>          elevation_level = string<br>          scope           = string<br>        })<br>      })<br>    }))<br><br>    certificate = optional(object({<br>      id             = string<br>      store_location = string<br>      visibility     = list(string)<br>    }))<br><br>  })</pre> | n/a | yes |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_id"></a> [id](#output\_id) | azurerm\_batch\_account properties. |

## Using it in a blueprint

IMPORTANT: We periodically release versions for the components. Since, master branch may have breaking changes, best practice would be to use a released version in form of a tag (e.g. ?ref=x.y.z)

```terraform
module "batch_pool" {
  for_each = local.configure_batch_pool.settings
  source   = "../../../../modules/Modules/batch_pool_2.0.0"
  settings = each.value
}
```

Sample value for settings.batch\_pool.tf as below:

locals {
  configure\_batch\_pool = {
    settings = {
      bp-app-sbox-bu-aen-001 = {
        name     = "bp-app-sbox-bu-aen-001"
        resource\_group\_name = "rg-app-sbix-bu-aen-001"
        account\_name        = azurerm\_batch\_account.example.name
        display\_name        = "Test Acc Pool Auto"
        vm\_size             = "Standard\_A1"
        node\_agent\_sku\_id   = "batch.node.ubuntu 20.04"

          auto\_scale {
           evaluation\_interval = "PT15M"

            formula = <<EOF
              startingNumberOfVMs = 1;
              maxNumberofVMs = 25;
              pendingTaskSamplePercent = $PendingTasks.GetSamplePercent(180 * TimeInterval\_Second);
              pendingTaskSamples = pendingTaskSamplePercent < 70 ? startingNumberOfVMs : avg($PendingTasks.GetSample(180 *   TimeInterval\_Second));
              $TargetDedicatedNodes=min(maxNumberofVMs, pendingTaskSamples);
            EOF
            }

              storage\_image\_reference {
                publisher = "microsoft-azure-batch"
                offer     = "ubuntu-server-container"
                sku       = "20-04-lts"
                version   = "latest"
              }

                container\_configuration {
                  type = "DockerCompatible"
                  container\_registries {
                    registry\_server = "docker.io"
                    user\_name       = "login"
                    password        = "apassword"
                  }
                }

                start\_task {
                  command\_line       = "echo 'Hello World from $env'"
                  task\_retry\_maximum = 1
                  wait\_for\_success   = true

                   common\_environment\_properties = {
                      env = "TEST"
                      }

                  user\_identity {
                    auto\_user {
                      elevation\_level = "NonAdmin"
                      scope           = "Task"
                    }
                  }
                }

                  certificate {
                    id             = azurerm\_batch\_certificate.example.id
                    store\_location = "CurrentUser"
                    visibility     = ["StartTask"]
                  }
                }
      }
    }
  }
<!-- END_TF_DOCS -->